version: 2

models:
  - name: dim_tags
    description: "{{ doc('dim_tags') }}"
    meta:
      owner: Christopher Lewis
      domain: stack_overflow
      layer: gold
      maturity: medium

    columns:
      - name: tag_id
        description: "Deterministic INT64 ID for a tag: ABS(FARM_FINGERPRINT(lower(trim(tag)))). Stable across runs and environments."
        tests:
          - not_null
          - unique

      - name: tag
        description: "Normalized tag key in lowercase with surrounding whitespace removed (sourced from questions, joined to tag attributes)."
        tests:
          - not_null
          - unique

      - name: tag_count_raw
        description: "Raw community-reported usage count for the tag from `stg_so_tags`; defaults to 0 when missing."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "tag_count_raw >= 0"

      - name: excerpt_post_id
        description: "Post ID of the tag’s short excerpt (if any) from `stg_so_tags`."

      - name: wiki_post_id
        description: "Post ID of the tag’s wiki page (if any) from `stg_so_tags`."

      - name: has_illegal_chars
        description: "TRUE if the tag contains characters outside the allowed set `[a-z0-9-+.#]`."
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

      - name: is_zero_count
        description: "TRUE if `tag_count_raw` is 0 or NULL upstream."
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
